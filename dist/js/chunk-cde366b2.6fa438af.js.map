{"version":3,"sources":["webpack:///./src/pages/Search/Search.vue?bf8d","webpack:///./src/pages/Search/Search.vue","webpack:///./src/pages/Search/Search.vue?a963"],"names":["class","id","keyword","resultsCount","to","Component","$route","meta","keepAlive","key","path","LIMITS","TYPES","props","String","setup","route","data","currentPages","value","name","getData","document","getElementById","scrollIntoView","behavior","counts","count","query","length","params","keywords","limit","offset","type","countName","result","newValue","includes","immediate","__exports__","render"],"mappings":"kHAAA,W,8DCEOA,MAAM,kBAAkBC,GAAG,U,GACzBD,MAAM,U,GACJA,MAAM,S,GAINA,MAAM,Q,iBACwD,M,iBACA,M,iBACF,M,oHATrE,eAkBM,MAlBN,EAkBM,CAjBJ,eAUM,MAVN,EAUM,CATJ,eAGM,MAHN,EAGM,C,8BAFD,EAAAE,SAAU,IACb,kBAAoC,YAA9B,KAAE,eAAG,EAAAC,cAAe,MAAG,KAE/B,eAIM,MAJN,EAIM,CAHJ,eAAiF,GAAnEC,GAAE,qCAAoC,EAAAF,W,yBAAa,iBAAE,C,qBACnE,eAAiF,GAAnEE,GAAE,qCAAoC,EAAAF,W,yBAAa,iBAAE,C,qBACnE,eAA+E,GAAjEE,GAAE,mCAAkC,EAAAF,W,yBAAa,iBAAE,C,yBAGrE,eAKc,Q,wBAJZ,gBADqBG,EACrB,EADqBA,UACrB,MAD8B,E,iBAC9B,eAEa,aADsB,EAAAC,OAAOC,KAAKC,W,iBAA7C,eAA6E,eAA7DH,GAAS,CAAgCI,IAAK,EAAAH,OAAOI,Q,8BAErC,EAAAJ,OAAOC,KAAKC,U,wCAA9C,eAA2D,eAA3CH,GAAS,c,0FAUzBM,EAAS,CAAE,eAAgB,GAAI,aAAc,GAAI,eAAgB,IACjEC,EAAQ,CAAE,eAAgB,EAAG,aAAc,KAAM,eAAgB,KACxD,GACbC,MAAO,CAAEX,QAASY,QAClBC,MAFa,WAGX,IAAMC,EAAQ,iBAGVC,EAAO,eAAS,CAAEf,QAAS,GAAI,eAAgB,GAAI,aAAc,GAAI,eAAgB,KACzF,eAAQ,OAAQe,GAGhB,IAAIC,EAAe,eAAS,CAAE,eAAgB,EAAG,aAAc,EAAG,eAAgB,IAClF,eAAQ,qBAAqB,SAACC,GAC5BD,EAAaF,EAAMI,MAAQD,KAE7B,eAAMD,GAAc,WAClBG,IACAC,SAASC,eAAe,UAAUC,eAAe,CAAEC,SAAU,cAI/D,IAAItB,EAAe,eAAI,GACnBuB,EAAS,CACX,eAAgB,CAAEN,KAAM,YAAaO,MAAO,GAC5C,aAAc,CAAEP,KAAM,UAAWO,MAAO,GACxC,eAAgB,CAAEP,KAAM,gBAAiBO,MAAO,IAtB5C,SAqDSN,IArDT,6FAqDN,yGAEMJ,EAAKf,UAAYc,EAAMY,MAAM1B,UAAWe,EAAKD,EAAMI,MAAMS,OAF/D,wDAKEZ,EAAKf,QAAUc,EAAMY,MAAM1B,QAGvB4B,EAAS,CACXC,SAAUf,EAAMY,MAAM1B,QACtB8B,MAAOrB,EAAOK,EAAMI,MACpBa,OAAQtB,EAAOK,EAAMI,OAASF,EAAaF,EAAMI,MAAQ,GACzDc,KAAMtB,EAAMI,EAAMI,OAGD,iBAAfJ,EAAMI,OACRU,EAAOE,MAAQ,IAhBnB,SAmB2B,eAAUF,GAnBrC,OAmBEb,EAAKD,EAAMI,MAnBb,OAqBMe,EAAYT,EAAOV,EAAMI,MAAMA,KACnCM,EAAOV,EAAMI,MAAMO,MAAQV,EAAKD,EAAMI,MAAMgB,OAAOD,GAEnDhC,EAAagB,MAAQF,EAAKD,EAAMI,MAAMgB,OAAOD,GAxB/C,4CArDM,wBAgFN,OAtDA,gBACE,kBAAMnB,EAAMI,QACZ,SAACiB,GAEMA,EAASC,SAAS,aAEvBjB,IAMAlB,EAAagB,MAAQO,EAAOV,EAAMI,MAAMO,SAE1C,CAAEY,WAAW,IAIf,gBACE,kBAAMvB,EAAMY,MAAM1B,WAClB,SAACmC,GACKA,GACFhB,OAgCC,CAAElB,kB,iCCzGb,MAAMqC,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAE1E,gB","file":"js/chunk-cde366b2.6fa438af.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Search.vue?vue&type=style&index=0&id=7b1ab122&lang=less&scoped=true\"","// 搜索页面, 一级路由页. 通过页面右上方的搜索框来触发弹出\r\n<template>\r\n  <div class=\"search clearfix\" id=\"search\">\r\n    <div class=\"header\">\r\n      <div class=\"title\">\r\n        {{ keyword }}\r\n        <span>找到{{ resultsCount }}个结果</span>\r\n      </div>\r\n      <div class=\"tabs\">\r\n        <router-link :to=\"{ path: '/search/songs', query: { keyword } }\">歌曲</router-link>\r\n        <router-link :to=\"{ path: '/search/lists', query: { keyword } }\">歌单</router-link>\r\n        <router-link :to=\"{ path: '/search/mvs', query: { keyword } }\">MV</router-link>\r\n      </div>\r\n    </div>\r\n    <router-view v-slot=\"{ Component }\">\r\n      <keep-alive>\r\n        <component :is=\"Component\" v-if=\"$route.meta.keepAlive\" :key=\"$route.path\" />\r\n      </keep-alive>\r\n      <component :is=\"Component\" v-if=\"!$route.meta.keepAlive\" />\r\n    </router-view>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, provide, watch } from \"vue\"\r\nimport { useRoute } from \"vue-router\"\r\nimport { reqSearch } from \"@/api/search\"\r\n\r\nconst LIMITS = { \"search-songs\": 30, \"search-mvs\": 20, \"search-lists\": 20 }\r\nconst TYPES = { \"search-songs\": 1, \"search-mvs\": 1004, \"search-lists\": 1000 }\r\nexport default {\r\n  props: { keyword: String },\r\n  setup() {\r\n    const route = useRoute()\r\n\r\n    // provide只能在setup中使用,所以一开始就要把data传递给子路由,data随时会变化,所以只能用响应式\r\n    let data = reactive({ keyword: \"\", \"search-songs\": [], \"search-mvs\": [], \"search-lists\": [] })\r\n    provide(\"data\", data)\r\n\r\n    // 保存各个子路由的当前页码,页码变化就发送请求. keyword变化时,在子路由中把对应的页码重置为1\r\n    let currentPages = reactive({ \"search-songs\": 1, \"search-mvs\": 1, \"search-lists\": 1 })\r\n    provide(\"uploadCurrentPage\", (value) => {\r\n      currentPages[route.name] = value\r\n    })\r\n    watch(currentPages, () => {\r\n      getData()\r\n      document.getElementById(\"search\").scrollIntoView({ behavior: \"smooth\" })\r\n    })\r\n\r\n    // 搜索结果数.\r\n    let resultsCount = ref(0)\r\n    let counts = {\r\n      \"search-songs\": { name: \"songCount\", count: 0 },\r\n      \"search-mvs\": { name: \"mvCount\", count: 0 },\r\n      \"search-lists\": { name: \"playlistCount\", count: 0 },\r\n    }\r\n\r\n    // 监视route.name,进入不同的子路由时重新发送请求\r\n    watch(\r\n      () => route.name,\r\n      (newValue) => {\r\n        // 防止监视其他路由路径\r\n        if (!newValue.includes(\"search-\")) return\r\n\r\n        getData()\r\n        /*\r\n          如果是从来没法发送过的请求, 那么先执行下面的代码, 此时请求还未获得响应,resultsCount被赋值为0\r\n            然后在getData()内部, 获得响应后, 再次给resultsCount赋予一个正确的值\r\n          如果是发送过的请求, 那么getData()会直接return. 此时去读取counts中保存的总结果数就行了\r\n        */\r\n        resultsCount.value = counts[route.name].count\r\n      },\r\n      { immediate: true }\r\n    )\r\n\r\n    // 监视route.query.keyword, 每次变化时重新发送请求\r\n    watch(\r\n      () => route.query.keyword,\r\n      (newValue) => {\r\n        if (newValue) {\r\n          getData()\r\n        }\r\n      }\r\n    )\r\n\r\n    async function getData() {\r\n      // 如果搜索关键词没变化,并且data中已经有了对应的数据,那么就不再重复发送请求\r\n      if (data.keyword === route.query.keyword && data[route.name].length) {\r\n        return\r\n      }\r\n      data.keyword = route.query.keyword\r\n\r\n      // 准备请求参数\r\n      let params = {\r\n        keywords: route.query.keyword,\r\n        limit: LIMITS[route.name],\r\n        offset: LIMITS[route.name] * (currentPages[route.name] - 1),\r\n        type: TYPES[route.name],\r\n      }\r\n      // api有问题,搜索歌曲时,limit为30,返回不到30个结果;limit为31,返回31个\r\n      if (route.name === \"search-songs\") {\r\n        params.limit = 31\r\n      }\r\n      // 把不同类型的搜索结果保存在data的不同属性中\r\n      data[route.name] = await reqSearch(params)\r\n      // 保存结果总数\r\n      let countName = counts[route.name].name\r\n      counts[route.name].count = data[route.name].result[countName]\r\n      // 执行到这里,说明这是一个从来没有发送过的请求,就直接改变resultsCount\r\n      resultsCount.value = data[route.name].result[countName]\r\n    }\r\n\r\n    return { resultsCount }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.header {\r\n  border-bottom: 1px solid var(--border);\r\n  .title {\r\n    padding: 20px 12px;\r\n    // padding: 20px 32px;\r\n    font-size: @font-size-title-lg;\r\n    font-weight: bold;\r\n    span {\r\n      margin-left: 5px;\r\n      font-size: @font-size-sm;\r\n      color: var(--font-color-grey-shallow);\r\n      letter-spacing: 1px;\r\n      font-weight: normal;\r\n    }\r\n  }\r\n  .tabs {\r\n    display: flex;\r\n    // padding-left: 25px;\r\n    a {\r\n      padding: 12px 0;\r\n      margin: 0 12px;\r\n      text-decoration: none;\r\n      color: var(--font-color-grey2);\r\n      &.router-link-active {\r\n        color: var(--tab-item-active-color);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./Search.vue?vue&type=template&id=7b1ab122&scoped=true\"\nimport script from \"./Search.vue?vue&type=script&lang=js\"\nexport * from \"./Search.vue?vue&type=script&lang=js\"\n\nimport \"./Search.vue?vue&type=style&index=0&id=7b1ab122&lang=less&scoped=true\"\n\nimport exportComponent from \"E:\\\\Programming\\\\Practice\\\\项目\\\\online-player\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-7b1ab122\"]])\n\nexport default __exports__"],"sourceRoot":""}